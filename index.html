<!DOCTYPE html>
<html>
<head>
    <title>fs.js demo</title>
    <script src="fs.js"></script>
    <script src="file.dnd.js"></script>
    <link href="styles.css" rel="stylesheet">
</head>
<body>
<section>
    <div id="drop_zone">Drop text files here</div>
    <div id="total_size"></div>
    <output id="list"></output>

    <ul>
        <li><p class="test-name">Read file as dataURL:</p><button onclick="test1();">Run</button><p id="test1"></p></li>
        <li><p class="test-name">Read file as text:</p><button onclick="test2();">Run</button><p id="test2"></p></li>
        <li><p class="test-name">Read file as binary string:</p><button onclick="test3();">Run</button><p id="test3"></p></li>
        <li><p class="test-name">Read file as buffer array:</p><button onclick="test4();">Run</button><p id="test4"></p></li>
        <li><p class="test-name">Read file that doesn't exists:</p><button onclick="test5();">Run</button><p id="test5"></p></li>
        <li><p class="test-name">Create file:</p><button onclick="test6();">Run</button><p id="test6"></p></li>
        <li><p class="test-name">Write text to file:</p><button onclick="test7();">Run</button><p id="test7"></p></li>
        <li><p class="test-name">Write dataURL to file:</p><button onclick="test8();">Run</button><p id="test8"></p></li>
    </ul>
</section>
<script>
File.prototype.shortName = function()
{
    alert('Overrided');
}
File.prototype.shortName = function()
{
    alert('Overrided2');
}
function handleFileSelect(files)
{
    var output = [];
    var size = 0;
    for (var i = 0, f; f = files[i]; i++)
    {
        if (!f.type==='text/plain')
        {
            continue;
        }
        size+=f.size;
        f.number=i;
        output.push('<li id="'+f.shortName()+'"><strong>', f.name, '</strong>', ' - ',f.size,'</li>');
        fs.readFileAsText(f,function(err,data)
        {
            if(err)
            {
                console.log(err);
            }
            else
            {
                console.log(data);
            }            
        });

        document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
    }
    var sizeInMB = (size/(1024*1014)).toFixed(1);
    document.getElementById('total_size').innerHTML = sizeInMB +' MB';
}
// Setup drag and drop zone
var dropZone = new FileDropZone('drop_zone',handleFileSelect);    
function test1()
{
    fs.readAsDataURL('test.zip',function(err,data)
    {
        if(err)
        {
            console.log(err);
            document.getElementById('test1').innerText="Failed with err: "+err.message();
        }
        else
        {
            console.log(data);
            document.getElementById('test1').innerText="Done: "+data;
        }
    });
}
function test2()
{
    fs.readAsText('test.txt',function(err,data)
    {
        if(err)
        {
            console.log(err);
            document.getElementById('test2').innerText="Failed with err: "+err.message();
        }
        else
        {
            console.log(data);
            document.getElementById('test2').innerText="Done: "+data;
        }
    });
}
function test3()
{
    fs.readAsBinaryString('test.txt',function(err,data)
    {
        if(err)
        {
            console.log(err);
            document.getElementById('test3').innerText="Failed with err: "+err.message();
        }
        else
        {
            console.log(data);
            document.getElementById('test3').innerText="Done: "+data;
        }
    });
}
function test4()
{
    fs.readAsArrayBuffer('test.txt',function(err,data)
    {
        if(err)
        {
            console.log(err);
            document.getElementById('test4').innerText="Failed with err: "+err.message();
        }
        else
        {
            console.log(data);
            document.getElementById('test4').innerText="Done: "+data;
        }
    });
}
function test5()
{
    fs.readAsText('fake.file',function(err,data)
    {
        if(err)
        {
            console.log(err);
            document.getElementById('test5').innerText="Failed with err: "+err.message();
        }
        else
        {
            console.log(data);
            document.getElementById('test5').innerText="Done: "+data;
        }
    });
}
function test6()
{
    fs.createFile('new_file.txt',function(err,data)
    {
        if(err)
        {
            console.log(err);
            document.getElementById('test6').innerText="Failed with err: "+err.message();
        }
        else
        {
            console.log(data);
            document.getElementById('test6').innerText="Done: "+data.name;
        }
    });
}
function test7()
{
    fs.writeText('new_file_with_text.txt','Line1\r\nLine2',function(err,data)
    {
        if(err)
        {
            console.log(err);
            document.getElementById('test7').innerText="Failed with err: "+err.message();
        }
        else
        {
            console.log(data);
            document.getElementById('test7').innerText="Done";
        }
    });
}
function test8()
{
    var content='UEsDBBQAAAAIAJp9Pj7t9B2+DQAAAA4AAAAIAAAAdGVzdC50eHTzycxLVTDk5fIB0UYAUEsBAhQAFAAAAAgAmn0+Pu30Hb4NAAAADgAAAAgAAAAAAAAAAQAgAAAAAAAAAHRlc3QudHh0UEsFBgAAAAABAAEANgAAADMAAAAAAA==';
    fs.writeDataURL('base64.zip',content,'application/zip',function(err,data)
    {
        if(err)
        {
            console.log(err);
            document.getElementById('test8').innerText="Failed with err: "+err.message();
        }
        else
        {
            console.log(data);
            document.getElementById('test8').innerText="Done";
        }
    });
}
</script>
</body>
</html>